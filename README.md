Компонент работает при наличии установленного AjaxForm, должен быть подключен jquery. Версия php 7+, версия MODX не ниже 2.7 (на тройке не тестировал). В ходе установки добавляется шаблон с примером вызова AjaxForm, чанк с примером разметки формы и создаются кастомный хук и валидатор FormIt: первый подключает отдельный файл с jquery-кодом на событие af_complete, второй подключает класс, который «рулит» логикой верификации формы по СМС.

## Основные преимущества

1. Невмешательство в ядро AjaxForm
2. Простота интеграции в действующую форму
3. Интервал между отправкой повторного СМС для предотвращения скликивания баланса.
4. Наличие тестового режима
5. Компонент срабатывает только в случае заполненных обязательных полей формы
6. Возможность добавления новых классов СМС-провайдера

-------------------

## Быстрый старт

1. Установить компонент из транспортного пакета.

2. В коде вызова сниппета AjaxForm добавить параметры:
	
   <code>'renderHooks' => 'smsValidateInit',
   'customValidators' => 'smsValidate',</code>

	в параметр 'validate' добавить обращение к СМС-валидатору 
  <code>'sms_code:smsValidate=^phone^'</code> (где 'phone - имя поля для ввода телефона)

  Пример вызова сниппета в шаблоне 'Валидация формы'.

--------------------

3. В коде чанка с формой добавить блок с разметкой поля для валидации по СМС. Пример в чанке 'smsvalidate_form'. Классы разметки с префиксом js служебные, их нельзя удалять или менять, также нельзя удалять инпуты и спан с классом error_sms_code из этого контейнера.

--------------------

## Настройки компонента

  - **smsvalidate.sms_time_limit** - время до повторной отправки СМС (в секундах) - если пусто, выставляется 30 секунд по умолчанию.
  - **smsvalidate.sms_test** - включение тестового режима - если выбрать 'да', то СМС на введенный в форме номер телефона не отправляется, а сгенерированный код выводится на экран
  - **smsvalidate.sms_button_repeat_class** - класс кнопки для повторной отправки СМС - кнопка для повторной отправки СМС в форме генерируется компонентом автоматически, есть возможность задать ей свой класс для css-стилизации
  - **smsvalidate.sms_code_length** - длина СМС-кода (не более 10)
  - **smsvalidate.sms_handler_class** - класс СМС-обработчика - вводится название класса СМС провайдера, об этом ниже.

--------------------
## Классы СМС-провайдеров

Все классы СМС-провайдеров должны находиться в директории **/core/components/smsvalidate/model/smsvalidate/handlers/** . В исходном варианте у компонента есть два класса для отправки СМС: 

  - **smsRu** - файл smsru.class.php (сервис sms.ru) 
  - **intisteleSms** - файл intistelesms.class.php (сервис intistele.com)
  - **smscRu** - файл smscru.class.php (сервис smsc.ru)

По умолчанию выбран класс **smsRu**. Данные доступа по API нужно вписать в конфиг класса **самостоятельно**.

--------------------
## Кастомные классы СМС-провайдеров


Для другого СМС-провайдера можно добавить свой класс: необходимо, чтобы название файла с классом было с суффиксом .class.php и чтобы класс был наследован от интерфейса sendSmsInterface, в котором заданы обязательные методы __construct() и send(). 

             
1. В метод construct() должен быть передан объект класса modX.

2. В метод send() передаются номер телефона и проверочный код, метод возвращает true в случае успешной отправки СМС, либо false.
